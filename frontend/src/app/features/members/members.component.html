<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Members</h3>
    <div>
      <mat-form-field appearance="outline" class="me-2">
        <mat-label>Search</mat-label>
        <input matInput placeholder="Name, Phone, Email, ID" #q (keyup.enter)="loadMembers(1,10,q.value)" />
      </mat-form-field>
      <mat-form-field appearance="outline" class="me-2">
        <mat-label>Status</mat-label>
        <mat-select #statusSel (selectionChange)="loadMembers(1,10,q.value,statusSel.value)">
          <mat-option [value]="''">All</mat-option>
          <mat-option value="active">Active</mat-option>
          <mat-option value="expired">Expired</mat-option>
          <mat-option value="soon_to_expire">Soon to expire</mat-option>
        </mat-select>
      </mat-form-field>
      <button mat-raised-button color="primary" (click)="openAddDialog()">Add Member</button>
    </div>
  </div>


  <table mat-table [dataSource]="data" class="mat-elevation-z1 w-100" *ngIf="data && data.length; else noData">
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef>Name</th>
      <td mat-cell *matCellDef="let m">{{ m.name }}</td>
    </ng-container>

    <ng-container matColumnDef="plan">
      <th mat-header-cell *matHeaderCellDef>Plan</th>
      <td mat-cell *matCellDef="let m">{{ m.membershipPlan?.name }}</td>
    </ng-container>

    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef>Status</th>
      <td mat-cell *matCellDef="let m">
        <span [ngClass]="{
          'text-success': m.status==='active',
          'text-danger': m.status==='expired',
          'text-warning': m.status==='soon_to_expire'
        }">{{ m.status }}</span>
      </td>
    </ng-container>

    <ng-container matColumnDef="endDate">
      <th mat-header-cell *matHeaderCellDef>Expiry</th>
      <td mat-cell *matCellDef="let m">
        <span [class.text-danger]="m.status==='expired'" [class.text-success]="m.status==='active'">{{ m.endDate }}</span>
      </td>
    </ng-container>

    <ng-container matColumnDef="feesPaid">
      <th mat-header-cell *matHeaderCellDef>Paid</th>
      <td mat-cell [class.text-success]="m.feesPaid > 0" [class.text-danger]="m.feesPaid === 0" *matCellDef="let m">{{ m.feesPaid }}</td>
    </ng-container>

    <ng-container matColumnDef="planFees">
      <th mat-header-cell *matHeaderCellDef>Plan Fees</th>
      <td mat-cell *matCellDef="let m">{{ m.planFees }}</td>
    </ng-container>

    <ng-container matColumnDef="dueAmount">
      <th mat-header-cell *matHeaderCellDef>Due</th>
      <td mat-cell [class.text-danger]="m.dueAmount > 0" [class.text-success]="m.dueAmount === 0" *matCellDef="let m">{{ m.dueAmount }}</td>
    </ng-container>

    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Actions</th>
      <td mat-cell *matCellDef="let m" (click)="$event.stopPropagation()">
        <button mat-button (click)="viewMember(m)">Quick View</button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="viewMember(row)" class="clickable-row"></tr>
  </table>
  <ng-template #noData>
    <div class="alert alert-info mt-3">No data found</div>
  </ng-template>
  <div class="d-flex justify-content-end mt-2">
    <span class="me-3">Page {{page}} â€¢ {{total}} total</span>
    <button mat-stroked-button (click)="loadMembers(1)">First</button>
    <button mat-stroked-button class="ms-2" (click)="loadMembers(page-1>0?page-1:1)">Prev</button>
    <button mat-stroked-button class="ms-2" (click)="loadMembers(page+1)">Next</button>
  </div>
</div>
